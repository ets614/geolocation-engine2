# Kubernetes Secrets Configuration for Detection API
# File: kubernetes/manifests/secrets.yaml
# Purpose: Store sensitive credentials (DB, JWT keys, Discord webhooks, TAK server)
# NOTE: In production, use sealed-secrets, external-secrets, or Vault

---
# Secret: TAK Server Credentials
apiVersion: v1
kind: Secret
metadata:
  name: tak-server-credentials
  namespace: default
  labels:
    app: detection-api
    component: tak-integration
type: Opaque
stringData:
  # TAK Server endpoint
  endpoint: "https://tak-server.internal:8089"

  # TAK Server username (service account)
  username: "detection-api-service"

  # TAK Server password (should be rotated regularly)
  password: "change-me-in-production"

  # TAK Server certificate (for mTLS)
  ca_cert: |
    -----BEGIN CERTIFICATE-----
    MIIBkTCB+wIJAKHH...
    -----END CERTIFICATE-----

  client_cert: |
    -----BEGIN CERTIFICATE-----
    MIIBkTCB+wIJAKHH...
    -----END CERTIFICATE-----

  client_key: |
    -----BEGIN PRIVATE KEY-----
    MIIEvQIBADANBgkqhkiG9w0BAQE...
    -----END PRIVATE KEY-----

---
# Secret: Database Credentials
apiVersion: v1
kind: Secret
metadata:
  name: db-credentials
  namespace: default
  labels:
    app: detection-api
    component: database
type: Opaque
stringData:
  # Database connection string
  database_url: "postgresql://detection_user:change-me-in-production@db.internal:5432/detection_api"

  # Database username
  db_username: "detection_user"

  # Database password
  db_password: "change-me-in-production"

  # Database host
  db_host: "db.internal"

  # Database port
  db_port: "5432"

  # Database name
  db_name: "detection_api"

---
# Secret: JWT Keys (Signing & Verification)
apiVersion: v1
kind: Secret
metadata:
  name: jwt-keys
  namespace: default
  labels:
    app: detection-api
    component: authentication
type: Opaque
stringData:
  # JWT Secret Key (used for signing tokens)
  jwt_secret_key: "change-me-in-production-use-strong-key-min-32-chars"

  # JWT Algorithm (HS256, RS256, etc.)
  jwt_algorithm: "HS256"

  # JWT Expiration (in seconds)
  jwt_expiration: "3600"

  # JWT Refresh Token Secret
  jwt_refresh_secret: "change-me-in-production-use-different-key"

  # RSA Private Key (for RS256, optional)
  jwt_rsa_private_key: |
    -----BEGIN RSA PRIVATE KEY-----
    MIIEpAIBAAKCAQEA0Z3...
    -----END RSA PRIVATE KEY-----

  # RSA Public Key (for RS256, optional)
  jwt_rsa_public_key: |
    -----BEGIN PUBLIC KEY-----
    MIIBIjANBgkqhkiG9w0B...
    -----END PUBLIC KEY-----

---
# Secret: Discord Webhook
apiVersion: v1
kind: Secret
metadata:
  name: discord-webhook
  namespace: default
  labels:
    app: detection-api
    component: notifications
type: Opaque
stringData:
  # Discord Webhook URL (for real-time alerts)
  webhook_url: "https://discord.com/api/webhooks/CHANGE_ME/CHANGE_ME"

  # Discord Bot Token (for advanced interactions)
  bot_token: "CHANGE_ME"

  # Discord Channel ID (for alerts)
  channel_id: "CHANGE_ME"

  # Discord Embed Color (hex code)
  embed_color: "3498db"

---
# Secret: API Keys & Rate Limiting
apiVersion: v1
kind: Secret
metadata:
  name: api-keys
  namespace: default
  labels:
    app: detection-api
    component: api-management
type: Opaque
stringData:
  # Master API Key (for administrative access)
  master_api_key: "change-me-in-production"

  # Service-to-Service API Key
  service_api_key: "change-me-in-production"

  # External Consumer API Key
  consumer_api_key: "change-me-in-production"

  # Rate Limit Configuration (requests per minute)
  rate_limit_requests: "1000"
  rate_limit_window_seconds: "60"

---
# Secret: Redis Cache Credentials (if Redis is used)
apiVersion: v1
kind: Secret
metadata:
  name: redis-credentials
  namespace: default
  labels:
    app: detection-api
    component: cache
type: Opaque
stringData:
  # Redis endpoint
  redis_url: "redis://:change-me-in-production@redis.internal:6379/0"

  # Redis password
  redis_password: "change-me-in-production"

  # Redis host
  redis_host: "redis.internal"

  # Redis port
  redis_port: "6379"

---
# Secret: Logging & Monitoring Credentials
apiVersion: v1
kind: Secret
metadata:
  name: logging-credentials
  namespace: default
  labels:
    app: detection-api
    component: observability
type: Opaque
stringData:
  # Datadog API Key (if using Datadog)
  datadog_api_key: "CHANGE_ME"

  # Splunk HEC Token (if using Splunk)
  splunk_hec_token: "CHANGE_ME"

  # New Relic License Key
  newrelic_license_key: "CHANGE_ME"

  # Elastic Cloud ID (if using Elasticsearch)
  elastic_cloud_id: "CHANGE_ME"
  elastic_cloud_auth: "CHANGE_ME"

---
# Secret: TLS Certificate for HTTPS
apiVersion: v1
kind: Secret
metadata:
  name: detection-api-tls
  namespace: default
  labels:
    app: detection-api
type: kubernetes.io/tls
stringData:
  tls.crt: |
    -----BEGIN CERTIFICATE-----
    MIIBkTCB+wIJAKHH...
    -----END CERTIFICATE-----
  tls.key: |
    -----BEGIN PRIVATE KEY-----
    MIIEvQIBADANBgkqhkiG9w0BAQE...
    -----END PRIVATE KEY-----
